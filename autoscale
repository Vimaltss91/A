import mysql.connector
from mysql.connector import Error
import requests
import os

# Slack settings (replace with your Slack bot token and channel ID)
SLACK_TOKEN = os.getenv('SLACK_TOKEN')  # Environment variable for better security
SLACK_CHANNEL = "your-channel-id"
SLACK_URL = "https://slack.com/api/chat.postMessage"

def send_slack_notification(message):
    headers = {
        'Content-Type': 'application/json',
        'Authorization': f'Bearer {SLACK_TOKEN}'
    }
    data = {
        'channel': SLACK_CHANNEL,
        'text': message
    }
    response = requests.post(SLACK_URL, headers=headers, json=data)
    if response.status_code != 200:
        print(f"Failed to send Slack message. Status code: {response.status_code}, Response: {response.text}")

def check_mysql_connection():
    try:
        # Trying to connect to MySQL
        connection = mysql.connector.connect(
            host='localhost',
            user='root'
        )
        if connection.is_connected():
            print("MySQL is up and running")
            connection.close()
    except Error as e:
        print(f"MySQL is not reachable: {e}")
        send_slack_notification("MySQL server is down. Please check the server immediately.")

if __name__ == "__main__":
    check_mysql_connection()
