import mysql.connector
from mysql.connector import Error
import requests
import os

# Slack settings (replace with your Slack bot token and channel ID)
SLACK_TOKEN = os.getenv('SLACK_TOKEN')
SLACK_CHANNEL = "your-channel-id"
SLACK_URL = "https://slack.com/api/chat.postMessage"
MYSQL_HOST = "localhost"  # Replace with your MySQL host
TROUBLESHOOT_LINK = "http://your-troubleshooting-link.com"  # Add your troubleshooting link

def send_slack_notification():
    message = (f"MySQL host '{MYSQL_HOST}' is currently down. Immediate action is required. "
               f"Please refer to the configuration page for troubleshooting: {TROUBLESHOOT_LINK}")

    headers = {
        'Content-Type': 'application/json',
        'Authorization': f'Bearer {SLACK_TOKEN}'
    }
    data = {
        'channel': SLACK_CHANNEL,
        'text': message
    }
    response = requests.post(SLACK_URL, headers=headers, json=data)
    if response.status_code != 200:
        print(f"Failed to send Slack message. Status code: {response.status_code}, Response: {response.text}")

def check_mysql_connection():
    try:
        # Trying to connect to MySQL
        connection = mysql.connector.connect(
            host=MYSQL_HOST,
            user='root'
        )
        if connection.is_connected():
            print("MySQL is up and running")
            connection.close()
    except Error as e:
        print(f"MySQL is not reachable: {e}")
        send_slack_notification()

if __name__ == "__main__":
    check_mysql_connection()
